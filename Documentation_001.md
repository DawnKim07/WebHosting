# 1장. 클라우드 컴퓨팅과 GCP

클라우드 컴퓨팅이란, 인터넷을 통해 가상의 컴퓨터 환경에서 작업할 수 있는 기술을 말합니다. 실제 물리적 서버의 리소스(정보처리장치, 저장공간 등)를 가상적으로 일부 할당받아 인터넷 접속 만으로 사용할 수 있는 것이죠. 정확히 원하는 수준 만큼의 리소스를 할당받을 수 있고, 심지어 변경 가능하며, 원격 접속이 용이하다는 점에서 상당히 매력적입니다. 특히 24시간 가동하는데 제약이 없고, 공간을 직접 차지하지 않는다는 장점이 크죠. Google Cloud Platform도 일종의 클라우드 컴퓨팅 플랫폼입니다. GCP에서는 가상 머신(VM, Virtual Machine)을 제공하는데, 이 VM이 일종의 가상 컴퓨터의 역할을 하게 됩니다. 다른 유명한 서비스로는 Amazon Web Service(AWS)가 있는데, GCP는 구글 계정 마다 최초 3개월에 한해 300달러 상당의 크레딧을 제공한다는 점에서 단기간, 또는 시험적으로 운영하기에 상당히 적합합니다. 비용 청구 또한 투명하고 직관적인 편이고요. 그래서 우리는 GCP를 사용해 웹 호스팅 서버를 구축해봅시다!

# 2장. GCP VM 생성

GCP에서는 '크레딧'의 형태로 기본적으로 어느 정도의 리소스 사용을 무료로 체험할 수 있게 해줍니다. 이는 사용자의 유형에 따라 조금 다른데요, 개인 납세자는 300달러의 크레딧을, 사업자 납세자는 400달러의 크레딧을 지원받을 수 있습니다. 100달러 차이면 커 보이긴 하지만, 3개월의 제한 안에 300달러를 쓰는 것도 사실은 벅찬 일이랍니다. 따라서 GCP 무료 체험 때문에 사업자등록까지 하실 필요는 없어요.

GCP를 이용하기 위해서는 거주지, 전화번호, 그리고 해외결제 가능 카드까지 등록해야 합니다. 부담이 될 수 있는데요, 무료 체험 기간이 끝나면 자동으로 VM 작동이 중지되며, 결제 또한 동의 후에 이루어지기 때문에 자동결제 되는 일은 없습니다. 가볍게 체험하실 수 있어요.

회원가입을 마치고 나면 Compute Engine API를 활성화해줘야 합니다.(Menu > Compute Engine) 이 Compute Engine이 VM을 사용가능하게 해주는 주된 서비스입니다.

Compute Engine API를 활성화해주고 나면 VM 인스턴스를 생성해야 합니다.(Menu > Compute Engine > VM Instance) '인스턴스 만들기' 와 'VM 가져오기' 두 가지 버튼이 있는데요, 저희는 GCP에서 자체 제공하는 VM을 생성할 것이기 때문에 인스턴스를 새로 만들어줍니다.

여러 입력창이 나오는데, 다음과 같이 설정해줍니다.

- 리전 : asia-northeast3(서울) > 리전은 물리적 서버의 위치를 뜻합니다. 주로 서비스될 지역에 있으면 지연율이 낮아지니 서비스를 하기에 편하겠죠? 저희는 서울로 해줍시다.
 - 영역 : asia-northeast3-a > 서울 리전에는 a, b, c 3개의 영역이 있는데요, 각 영역에서만 사용할 수 있는 VM 종류가 있습니다. 저희는 a를 사용하면 되겠어요.
- 머신 구성: E2 > VM의 하드웨어 종류를 선택할 수 있습니다. 기본적으로는 E2를 사용하면 괜찮아요. 굉장한 성능은 아니지만, 소규모 서버를 만들기에는 충분합니다.
 - 머신 유형 : e2-micro > 코어와 램이 굉장히 작아보이지만, 웹 호스팅에는 저희가 사용하는 컴퓨터에 비해 굉장히 적은 리소스로도 운영이 가능합니다. 비용의 측면도 생각해야 하기에 웹 서버의 사용 가능성을 예측하고 그에 맞게 준비를 해야합니다. 그리고 주의할 점으로, 커스텀 설정을 사용하면 기본 설정들보다 가격이 더 높게 책정됩니다. 이 점 유의해주세요.
- 디스플레이 기기 사용 설정 : (체크 선택) > 디스플레이 출력을 내보낼지 설정하는 곳입니다. 기본적으로 VM은 리눅스 기반으로 된, 콘솔 형태의 운영체제를 가지고 있어요. 콘솔이란 한줄씩 명령어를 입력하는, UI가 없는 입력창으로, 윈도우의 CMD창을 생각하시면 쉬울 거에요. 그러나 이런 리눅스에서도 디스플레이를 사용할 수 있는 'X11'이라는 기술이 있는데, 이걸 사용할 수도 있으니 설정해주는 겁니다.

다음으로는 부팅 디스크를 변경해줍니다.

- 운영체제 : Ubuntu > 리눅스에는 Debian, CentOS, RedHat 등 많은 세부 OS가 있지만, 기본적으로 Ubuntu가 구글에서 정보를 얻기에 상당히 편하고 운영체제도 사용하기 편리하더라고요. 저희는 Ubuntu로 해줍시다.
 - 버전 : Ubuntu 20.04 LTS (x86/64) 기본적으로 웹 호스팅 서버는 성능 보다는 안정성이 훨씬 중요하기 때문에, 안정화 버전인 LTS를 사용하는 것이 매우 권장돼요. 또한, 최신 버전은 안정화되었더라고 오류가 있을 가능성이 있어서 좀 더 구형이지만 그만큼 신뢰성있는 20버전을 사용해줍시다. 저희는 인텔 기반 프로세서를 할당 받을 것이기 때문에 x86/64 OS를 받아줍니다. 
- 부팅 디스크 유형 : 균형 있는 영구 디스크 > 이건 일반적인 HDD/SSD의 구분과 다르게 GCP에서 책정한 디스크 구분이에요. 가격적인 부분도 생각하면 균형있는 디스크 정도면 충분해요!
 - 크기: 20GB > 기본적으로는 10GB로 책정되어있는데, 크기가 큰 모듈을 사용하거나 사이트의 크기가 커지면 조금 모자랄 수도 있어서, 20GB로 해줍시다.

디스크 설정을 완료해주시고, 나머지 설정도 해봅시다!

- ID 및 API 액세스 액세스 범위 : 모든 Cloud API에 대한 전체 액세스 허용 (체크 선택) > 이건 IAM이라고 해서 프로젝트 단위로 계정 군한 나눠서 관리할 때 체크 해제하는 옵션이에요. 저희는 개인이 모두 관리하니 체크 선택!
- 방화벽: HTTP 트래픽 허용 (체크 선택), HTTPS 트래픽 허용 (체크 선택) > 외부에서 HTTP 및 HTTPS 통신으로 VM에 접근할 때, 방화벽이 차단할지 여부를 확인하는 거에요. HTTP 통신이란? 인터넷에서 WWW(World Wide Web)을 통해 이루어지는 통신에 해당하는 통신 규약(프로토콜)이에요. HTTPS 통신은 HTTP 통신에 SSL 보안통신을 더해 보안을 강화한 거에요. 자세히는 복잡하니 생략! HTTP 통신은 포트번호 80, HTTPS 통신은 포트번호 443을 사용하는데, 해당 포트를 개방하면 외부에서 접속이 가능해져요. 체크를 선택해야 웹 서버 통신이 허용되니 둘 다 체크 선택!

이렇게 하면 VM을 생성하는데는 성공했어요! 조금 기다리면 생성될거에요 :>

# 3장. GCP 개발 환경 최적화

VM을 만들긴 했는데, 문제가 있어요. 사실 GCP 홈페이지는 들어가기에 번거롭기도 하고, 파일 업로드 및 다운로드에서 자주 오류를 일으켜요. 그래서 우리는 통신 프로그램을 통해 GCP에 원격 접속을 해 볼거에요!

우선 GCP에서 설정해줘야 하는게 있어요. 바로 VM의 외부 IP 고정인데요, 구글에서 갓 생성한 VM은 외부 IP가 고정되어있지 않아요. 외부 IP를 알아야 해당 VM에 접속할 수 있는데, 이게 변해버리면 골치아프겠죠? 그래서 우리는 이걸 변하지 않게 해줄거에요.

GCP의 VM 네트워크 설정으로 들어가보아요. (Menu > VPC Network > IP Address) 여기서 VM에 할당된 내부IP와 외부IP를 보실 수 있는데요, 외부IP가 바로 우리가 VM에 접속하기 위해 필요한 IP주소에요. 해당 IP주소를 "고정 IP 주소로 승급" 버튼만 눌러주면 쉽게 고정이 된답니다!

이제 접속 대상을 확정했으니 VM에 접속할 방법을 찾아야겠죠? Putty라는 프로그램을 사용하면 쉽게 VM에 접속해, 콘솔 창을 열고 명령을 입력할 수 있어요.(https://putty.org/) 

Putty를 다운로드하면 여러가지 패키지 프로그램이 같이 깔리는데요, 이 중 PuttyGen을 살펴보아요. PuttyGen은 RSA 암호 키를 생성해주는 프로그램이에요. RSA는 암호 생성의 한 방식으로, 공개 키와 비공개 키를 가지고 있어요. 공개 키가 등록되어 있는 서버(VM)에 클라이언트(Putty 등 사용자 층 프로그램)가 비공개 키를 제공하면, 서버에서 이를 확인해 접속을 승인해준답니다. 여기서 접속은 SSH라는 프로토콜을 통해서 이루어져요. SSH는 보안 쉘(콘솔)이라는 뜻으로, 비공개 키 파일을 가지고 있지 않으면 절대로 접속할 수 없답니다. 참고로 SSH 프로토콜의 통신 포트 번호는 22에요.

PuttyGen을 켜고, RSA 2048 방식(2048은 비트 수를 뜻해요)을 체크하고, Generate버튼으로 키를 생성해요. 여기서 Public key라고 출력되는 부분을 key.txt라는 텍스트 문서에 저장해줘야 해요. 이 텍스트는 공개 키가 포함되어있어서, 나중에 서버에 등록해야 하거든요. 그리고 "Key comment" 부분에는 사용할 사용자명을 입력해요. 저는 kimdawn으로 할게요. 그리고 "Key passphrase" 부분에서는 비공개 키 파일을 열 때마다 제한을 거는 암호를 부여할 수 있어요. 설정이 끝났으면, Save Public Key 버튼으로 공개키를 key.key 파일로 저장하고, 비공개키를 key.ppk 파일로 저장해줍니다. 이 key.ppk 파일은 VM에 접속할때마다 가지고 있어야 하니 잘 보관해두세요!

이제 GCP 서버에 공개 키를 등록해야 해요. (Menu > Compute Engine > Metadata > SSH Key) 여기에 아까 key.txt에 붙여놨던 텍스트를 복사해서 다시 붙여줍시다. 이제 VM에 원격 접속하기 위한 준비가 끝났어요!

Putty를 켜줍시다! 이제 비공개 키 파일을 등록해줘야 해요.(Connection > SSH > Auth > Credentials) 인증서 파일에서 SSH 키를 생성한 경우에는 인증서 파일도 필요한데, 저희는 그 경우는 아니니 PPK 파일만 등록해주면 되어요. 그리고 Session 항목에 들어가서, "Host Name" 항목에는 아까 확인했던 GCP VM의 외부 IP주소를 입력해주세요. "Connection type"은 그대로 SSH로 해주시고요. Putty는 간편한 기능으로 이렇게 설정된 것을 '세션'으로 저장할 수가 있어요. "Saved Sessions"의 빈칸에 적당한 세션명을 입력하고, Save 버튼으로 저장하면 된답니다! 다음에 Putty를 켤때는, 바로 Session 항목에서 저장된 세션을 Load 버튼으로 불러오면 돼요.

접속이 정상적으로 되었다면 경고창이 하나 뜰 수 있어요. 제가 접속하려는 컴퓨터가 제가 의도한 컴퓨터가 아닐 수 있다는 건데, IP주소에 이상이 있지 않는 이상 그럴 일은 거의 없어요. Accept 눌러서 그대로 진입해주시면 됩니다!

그 다음으로는 "login as: "라는 문구가 뜨는데, 여기서는 아까 RSA 키 만들때 썼던 사용자명을 입력하면 돼요. 저는 kimdawn 입력할게요.

그러고 나면 "Passphrase for key: "라는 문구가 떠요. 여기서도 역시 아까 RSA 키 만들때, 비공개 키 파일(PPK)에 걸었던 비밀번호를 입력하면 되어요!

이 과정이 모두 끝난다면 정상적으로 접속이 가능하답니다!

그 다음으로는 FileZilla를 사용해보아요.(https://filezilla-project.org/download.php) FileZilla는 로컬 컴퓨터(개발에 사용되는 사용자의 컴퓨터)와 리모트 컴퓨터(원격 VM) 사이에 파일의 업로드, 다운로드를 자유롭게 가능하도록 해주는 통신 프로그램이에요. 설치하다보면 중간에 Oracle browser 설치하라 하는데 Decline해주시는거 잊지 마시고요!

사이트 관리자로 진입해 (파일 > 사이트 관리자) 새 사이트를 만들어줍시다. 우측에 여러 입력 항목이 있는데 살펴볼게요.
- 프로토콜 : SFTP > 저희는 SFTP 프로토콜을 사용할 거에요. 일반적인 파일 전송 방식인 FTP 프로토콜에 보안 프로토콜인 SSH를 합친 거랍니다. 
- 호스트 : 34.xxx.xxx.xxx (VM의 외부IP주소) > 우리가 접속해야 할 대상을 지정하는 곳이에요. 보통 로컬 컴퓨터를 클라이언트, 리모트 컴퓨터를 호스트라고 부른답니다.
- 포트 : 22 > SSH를 사용하는 만큼 22번 포트를 사용합니다. 사실 SFTP를 특정해줬기 때문에 포트는 입력하지 않아도 상관없어요.
- 로그온 유형 : 키 파일 > 저희는 SSH 키를 통해 접속을 할 거기 때문에, 아까 Putty에서 그랬던 것처럼 키 파일을 제공해줘야 서버에서 접속을 승인해주겠죠? 키 파일 유형으로 해주세요.
- 사용자 : 키 파일을 만들때 입력했던 사용자명을 입력하면 됩니다. 저는 kimdawn이네요.
- 키 파일 : 아까 저장했던 key.ppk 파일을 찾아서 연결해주세요.

이렇게 설정을 해주시면, 연결할 수 있답니다! 이제 다음에 FileZilla를 사용할 때도 그냥 사이트 관리자에서 저장된 설정을 불러오면 돼요.

연결을 시도하면 마스터 비밀번호로 PPK파일 비밀번호를 저장할지(입력을 대신할지) 옵션을 정할 수 있어요. PPK파일 비밀번호가 매우 복잡한게 아니라면, 마스터 비밀번호도 까먹을 수 있으니 굳이 설정하지 않는 걸 추천드려요.

그 다음으로는 비밀번호를 입력해주면, 접속에 성공하면서 우측 창의 하얗던 '리모트 사이트' 영역에 디렉터리들이 로딩된답니다!

# 4장. LAMP 스택 구축

LAMP란, 웹 서버 호스팅에 필요한 핵심 서버 시스템 프로그램들을 지칭해요. Linux, Apache, Mysql, Php의 앞글자를 따온 거라고 볼 수 있죠. Linux는 저희가 2장에서 설치했던 운영체제 종류이고, Apache는 HTTP(S) 통신을 가능하게 해주는 서버 역할을 해요. Php는 백엔드 프로그래밍 환경을 제공하고, Mysql은 Php로 활용 가능한 데이터베이스 서버 역할을 한답니다.

우선 이 패키지들을 VM에 설치해야 하니, Putty를 켜서 VM에 접속해줍시다.

VM을 생성 후에 최초로 접속하면 다음과 같은 명령을 입력해줘야 해요.
`sudo apt update`
`sudo apt -y upgrade`
위 명령어는 VM에 설치된 패키지와 라이브러리를 동기화하고 최적해준답니다. 

## Apache 설치
daemon(윈도우의 서비스 개념)명이 httpd로도 불리는 apache2, 설치해봅시다.
`sudo apt install apache2`
서비스가 정상적으로 작동되는지 확인되면, 다음과 같은 명령어를 입력해줍니다.
`sudo systemctl enable apache2` Apache는 기본적으로 VM이 재부팅될 때 같이 재시작되지 않아요. 그래서 마치 시작 프로그램에 등록하듯, Apache를 enable 상태로 설정해줘야 합니다.

Apache가 설치되고 나면, GCP VM의 외부IP를 인터넷 브라우저에 입력하면 Apache의 기본 창을 볼 수 있어요! 그렇다면 성공입니다!

## MySQL 설치
MySQL역시 apt 명령어로 설치해주고, systemctl 명령어로 활성화해주세요.
`sudo apt install mysql-server`
`sudo systemctl enable mysql`

## PHP 설치
PHP 라이브러리 자체, Apache와의 연동 라이브러리, MySQL과의 연동 라이브러리를 설치해줍니다. PHP는 최신 버전이 8.3까지 있지만, 저희가 쓰는 OS인 Ubuntu 20.04 LTS에서는 PHP 버전을 7.4까지만 지원해요ㅠㅠ 그래서 지원 버전에 맞게 깔겠습니다!
`sudo add-apt-repository ppa:ondrej/php`
`sudo apt update`
`sudo apt -y upgrade`
`sudo apt install php7.4 libapahce2-mod-php7.4 php7.4-mysql php7.4-mbstring`
여기서 add-apt-repository 명령어로 패키지 설치 목록을 등록한 후에 apt update 명령어로 리로드 해주는걸 잊지 마셔요!

설치되고 나면, 다음 명령어로 웹 서버의 메인 디렉터리에 phpinfo.php 파일을 생성합니다.
`sudo vi /var/www/html/phpinfo.php`

vi편집기로 진입한 다음, 아래 PHP 코드를 입력해주세요.
```php
<?php
  phpinfo();
?>
```

저장이 완료되면, 브라우저를 켜고, 아래 URL을 입력해보아요.(xxx.xxx.xxx.xxx 는 VM의 외부IP를 의미해요!)
`http://xxx.xxx.xxx.xxx/phpinfo.php`
PHP 7.4 버전에 해당하는 상태 창이 뜬다면 정상적으로 설치된 거에요.

## phpmyadmin 설치
오잉! 사실 LAMP는 다 설치했지만, 하나가 더 남았답니다. phpmyadmin은 php 기반으로 작성된 UI(User Interface)를 통해 웹페이지에서 쉽게 MySQL을 관리할 수 있게 해주는 도구에요. 다음 명령어로 설치할 수 있어요.
`sudo apt install phpmyadmin`

설치하다 도중에 보라색 설정 창이 떠도 당황하지 마세요! 다음과 같이 선택해주면 되어요.

- 첫번째 화면 : 자동으로 재설정할 웹 서버 종류 선택 > apache2
- 두번째 화면 : phpmyadmin 패키지 설치를 위한 데이터베이스 공간 확보 여부 선택 > Yes
- 세번째 화면 : phpmyadmin을 통해 MySQL에 접속할 비밀번호 설정 > (개인 비밀번호)

이제 phpmyadmin에 접속해보아요! 아래의 URL을 브라우저에 입력해주세요.(xxx.xxx.xxx.xxx는 VM의 외부 IP를 의미)
`xxx.xxx.xxx.xxx/phpmyadmin`
접속이 되었다면, 로그인 화면이 뜰 거에요.
이때 다음과 같이 입력해줍시다.

- 사용자명 : phpmyadmin
- 암호 : (phpmyadmin 설정할 때 썼던 비밀번호)

그런데 로그인을 하고 데이터베이스 항목을 클릭해보면, 권한이 없다고 뜹니다! MySQL은 기본적으로 'root' 유저에는 모든 권한을 부여하지만, 'phpmyadmin' 유저에는 보안상 권한 제한을 겁니다. 권한을 받아오기 위해, 다시 Putty로 VM에 접속해줍니다. 접속한 뒤에 아래 명령어로 MySQL 콘솔로 진입할 수 있어요.
`sudo mysql`

MySQL 콘솔에서, 다음 명령어를 실행합니다. 명령의 뜻은 이래요: "localhost에서 접속한 phpmyadmin 유저에게는, 모든 데이터베이스 및 하위 테이블의 모든 권한을 주겠다"
```sql
GRANT ALL PRIVILIGES ON *.* TO 'phpmyadmin'@'localhost';
```

권한 부여가 끝나면, 다음 명령어로 MySQL 콘솔에서 리눅스 콘솔로 빠져나와줄 수 있어요.
`quit;`

이렇게 하면 기본적인 웹 서버 세팅은 끝났답니다!

# 5장. 도메인 DNS 설정

이제 웹 서버는 구축이 끝났지만, 아직 하지 않은 것이 있어요. 바로 도메인 설정! 우리가 URL을 입력할때 IP주소를 바로 입력할 수도 있지만, '도메인'을 입력할 수도 있답니다! 도메인이란 영문자 및 숫자로 이루어진 문자들이 IP주소를 대신 가리켜주는 것을 뜻해요. 어떤 도메인을 IP주소에 연결해놓으면, 우리는 도메인만 입력해도 해당 IP로 자동으로 연결되죠!

여기서 다시 한 번 비용 부담이 발생하는데요, 도메인은 무료 도메인도 있긴 하지만 가격이 상당히 저렴한 도메인도 많기 때문에 하나 사는것도 괜찮아요. 사용할 수 있는 기능도 많아지고요. 저는 Cloudflare 사에서 도메인을 하나 살게요.

.net, .com, .org 등 많은 도메인이 있는데요, 저는 가장 많이 사용하면서도 가격이 저렴한 .com을 주로 사서 쓰고 있어요. 가격은 1년에 10달러 정도랍니다! 구입하고 나면 연간 자동결제를 할지 체크할 수 있는데, 계획에 따라 해주시면 될 것 같네요!

DNS 설정을 해봅시다(Menu > DNS > Records)! DNS란, 간단히 말하면 하나의 URL이 다른 URL을 가리키게 해주는(Redirect) 기술이에요. 이걸 설정해야 비로소 도메인을 산 의미가 생기죠!

Cloudflare는 기본적으로 DNS 설정 몇 개를 권장하는데요, 다음과 같이 DNS 레코드를 생성해주면 돼요.

## SPF, DKIM, DMARC 레코드 생성
이름은 어려워 보일 수 있는데, 이 설정들은 DNS 레코드의 정보를 이메일로 전송해주는 역할을 해줘요. 설정 창을 따라가서 이메일만 입력하면, 자동으로 레코드가 추가된답니다.

## CNAME 레코드 생성
CNAME 레코드는 하나의 도메인을 다른 도메인으로 리디렉션 해주는 기능을 해요. 우리가 도메인 입력할때, 앞에 'www'라는 글자를 원래는 붙여야 하지만 안붙여도 되는 때가 많잖아요? 그게 모두 CNAME 레코드가 설정되어 있는 것이에요. 메인 도메인 앞에 점(.)으로 구분되어 나오는 부분을 '서브 도메인'이라고 하는데, 이는 여러개의 서브 도메인이 묶여져 하나의 메인 도메인을 이루는 것처럼 보이게 하는 효과를 가지고 있어요. 기본 사이트는 www 서브도메인을 쓰는게 보편적이라서, 저희도 그렇게 할게요. 아래처럼 입력해주세요.
- Type : CNAME
- Name : www
- Target : @ > 이 기호는 루트 도메인, 즉 메인 도메인을 뜻하는 표시로 쓰여요!
- Proxy status : Proxied > 프록시란 클라이언트와 호스트 사이에 정보를 통과시키거나 관리할 수 있는 통신 매개 서버에요. Cloudflare에서 제공하는 프록시를 제공 받을 수 있어요.

## A 레코드 생성
A 레코드는 도메인을 IP 주소로 연결시켜주는 실질적인 DNS 설정이에요. A 레코드는 IPv4 주소를, AAAA 레코드는 IPv6 주소를 연결할 수 있어요. IP주소에는 v4와 v6이 있는데, 우리가 대부분 사용하는 주소가 4단위의 3자리 숫자로 구성된 v4 주소랍니다. 설정 한 번 해볼까요?
- Type : A
- Name : @
- IPv4 address : (VM의 외부IP 주소)
- Proxy status : DNS only > GCP와 Cloudflare에서 제공하는 프록시가 통신 오류 또는 거부를 일으키는 경우가 있더라고요. 그래서 프록시는 꺼줄게요!
- TTL : Auto

이렇게 DNS 레코드까지 설정해주면, 우리는 도메인을 통해 VM 웹서버에 접속까지 할 수 있게 되었답니다!

리눅스 VM의 /var/www/html 위치를 기반 디렉터리로 해서 이제 파일과 폴더를 채워넣으면 돼요. 제가 가진 도메인이 www.kimdawn.com이라고 한다면, /var/www/html/account/login.php 위치에 있는 파일은 www.kimdawn.com/account/login.php 라는 URL로 기본적으로 접근이 가능하답니다!

# 1부 부록

## 1절. Linux 기본 명령어

### 접두사
- `sudo` : 관리자 권한으로 명령어 실행

### 명령어
- 패키지 관련
 - `apt update` : 패키지 목록(레포지터리) 업데이트
 - `apt upgrade` : 패키지 목록 업그레이드(업데이트가 가능한 경우 자동 설치)
 - `apt install` : 패키지 설치
 - `apt reinstall` : 패키지 재설치(오류 등으로 인해)
 - `apt purge` : 패키지 제거

- 디렉터리 관련
 - `cd ~` : 현재 폴더에서 ~ 경로로 진입
 - `cd /~` : 루트 폴더 기준으로 ~ 경로로 진입
 - `cd ..` : 현재 폴더의 한 단계 상위폴더로 이동
 - `cd` : 루트 폴더로 이동
 - `ls` : 현재 폴더의 하위 폴더 및 파일 목록 출력
 - `mv` : 파일(폴더)명 변경 또는 위치 이동
 - `rm` : 파일(폴더) 삭제

- 시스템 서비스 관련
 - `service start/stop/restart/status ~` : 시스템 서비스 시작/중지/재시작/상태 표시
 - `systemctl ~ start/stop/restart/status` : 시스템 서비스 시작/중지/재시작/상태 표시
 -` systemctl ~ enable `: 시스템 서비스 활성화(재부팅 시 자동시작)

- vi 편집기 관련
 - `vi/vim ~` : 파일 편집기 실행
 - (Esc키) : 명령 모드 전환
 - (i키) : 입력 모드 전환
 - `:q` : 명령 모드에서, 저장하지 않고 종료(편집을 했을 경우 불가능)
 - `:wq` : 명령 모드에서, 저장하고 종료

- 웹 다운로드 관련
 - `wget ~` : 현재 폴더에 해당 URL이 가리키는 파일 다운로드

- 압축 관련
 - `tar -zxvf ~` : tar.gz 파일 압축해제

## 2절. LAMP 추가 설정

### Linux
#### 루트 로그인 비허용
`/etc/ssh/sshd_config`에서 SSH 접속에 대한 설정을 관리할 수 있어요.
- `#PermitRootLogin prohibit-password` : SSH를 통해 루트 계정(모든 권한을 가진 관리자 계정)으로 로그인 하는 것을 어떻게할지 설정하는 부분이에요. 기본적으로는 비밀번호를 입력하는 것만 금지되어있는데, 이걸 보안을 위해`PermitRootLogin no`로 바꿔줍시다. 

### Apache
#### 웹 서버 정보 변경
`/etc/apache2/sites-enabled/000-default.conf`에서 웹 서버에 대해 인터넷에 제공되는 정보를 바꿀 수 있어요. 
- `ServerAdmin webmaster@localhost` : 웹서버 관리자의 이메일 주소를 남길 수 있어요. 서버에 오류가 생겼을 때 사용자로부터 연락이 올 수도 있으니 관리용 계정으로 설정해보아요.

#### 기타 주요 설정 파일
주요 설정파일 위치를 기록해놨으니, 추가 설정이 필요하거나 오류가 발생하면 한번 찾아보셔요!
- Apache2
 - `/etc/apache2/sites-enabled/000-default.conf`
 - `/etc/apache2/apache2.conf`
- MySQL
 - `/etc/mysql/mysql.conf.d/mysqld.cnf`
- PHP
 - `/etc/php/7.4/apache2/php.ini`
- phpmyadmin
 - `/etc/phpmyadmin/apache.conf`
 - `/etc/phpmyadmin/config.inc.php`

## 3절. 오류 해결
컴퓨터를 뚝딱거리는데 있어서 오류는 언제나 찾아오죠ㅠ 제가 이번에 포럼 준비하면서 맞딱드렸던 오류들을 한번 정리해볼게요!

### Putty를 통한 SSH 연결 안됨
Putty에서 접속을 눌렀는데 Connection timed out(연결하는데 너무 오래 걸림)이 뜨는... 분명 하라는대로 했는데 네트워크 상의 여러 문제로 인해 안될 수도 있어요. 한 번 점검해볼까요?

#### 클라이언트 기기 점검
윈도우 기본 방화벽이 SSH 연결을 막고 있을 가능성도 있어요. 방화벽 규칙에 들어가서(제어판 > Windows Defender 방화벽 > 고급 설정) 인바운드 규칙, 아웃바운드 규칙에 각각 TCP 22번 포트를 모든 IP에 대해 개방하도록 설정해주면 됩니다.

#### 네트워크 점검
사용하는 운영체제에 문제가 없다면, 네트워크 문제일 가능성도 높죠. 다른 라우터에 연결된 LAN이나 WiFi에 접속했을 때 문제가 해결되는지 살펴보세요. 네트워크 문제가 맞다면, 포트포워딩이 필요할 수도 있어요. 포트포워딩에 대해서 간단하게 설명할게요.
- 포트포워딩이란 공유기, 허브, 모뎀과 같은 라우터에서, 특정 기기(IP)의 특정 포트 번호에 대해 다른 모든 IP에서 연결을 시도하는 접속을 허용해주는 것을 뜻해요. 쉽게 말해 특정 포트를 완전히 개방하는거죠.
- 윈도우 cmd 창에 `ipconfig`를 입력하면 '기본 게이트웨이' 라고 출력되는 IP주소로 접속하면, 연결된 라우터의 관리 페이지가 나타나요. 기업마다 다르지만 검색을 통해 초기 로그인 방법을 찾아주시고, 로그인이 되면 네트워크 상태를 확인해주세요. 'WAN IP'가 `192.168.`로 시작한다면, 다른 라우터가 하나 더 연결된 이중 구조라는 뜻이에요. 그렇지 않다면, 포트포워딩 설정에서 SSH 프로토콜의 포트인 22번을, 현재 접속한 기기가 할당받은 내부IP에 맞게 개방해주세요.
- 만약 이중 라우터 구조라면, 포트포워딩을 두 번 해야한답니다. "클라이언트-내부라우터-외부라우터-인터넷망" 의 구조로 이루어져 있다고 생각해볼까요? 클라이언트의 기본 게이트웨이가 내부라우터의 관리 주소였죠? 마찬가지로 내부라우터의 기본 게이트웨이가 외부라우터의 관리 주소랍니다. 따라서 외부라우터에서 내부라우터로 포트포워딩을 한 번, 그리고 내부라우터에서 클라이언트로 포트포워딩을 한 번 이렇게 총 두 번 해야 합니다.

### PhpMyAdmin 페이지 오류(404, 500)
분명 LAMP스택과 phpmyadmin까지 정상적으로 설치했는데, 외부에서 접속을 하려니 안되는 기현상이 발생할 수 있어요. 제가 찾은 해결법은 다음과 같습니다!

#### Apache2 설정 추가
`/etc/apache2/apache2.conf` 파일의 맨 하단에 `Include /etc/phpmyadmin/apache.conf` 를 입력해줍니다. 이렇게 하면 아파치 웹 서버가 phpmyadmin을 인식할 수 있게 되어 404 오류를 해결할 가능성이 생깁니다!

#### PHP 버전 확인
리눅스 콘솔에서 `php -v` 명령어로 PHP버전을 확인해보세요. PHP 버전은 7.4 이하여야 합니다! 만약 8.0 이상의 상위 버전이 설치되었다면 500 오류를 일으킬 수 있습니다.
